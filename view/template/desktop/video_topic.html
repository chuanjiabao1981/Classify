<%include file="common/head.html"/>
<%!
	import view.filter
	from config import template,site
%>
<body>
    <div id="Wrapper">
    <div id="Main">
        <div id="Sidebar">
        </div>
        <div id="Rightbar">
        </div>
        <div id="Content">
            <div class="box">
                % if "content" in topic:
		<div class="cell" style="min-height: 73px;">
		% else:
		<div class="inner" style="min-height: 73px;">
		% endif
                    <div class="fr snow" style="padding-left: 10px; padding-bottom: 10px;"><a href="/member/{{ topic.member.username }}">${topic.author|view.filter.avatar("large")}</a></div>
                    <span class="bigger"><a href="/">${site.title}</a> ${template.chevron} <a href="/go/${topic.node_url}">${topic.node_name|h}</a></span>
                    <h1>${topic["title"]|h}</h1>
		    <small class="fade">
		      % if 0:
			  % if 0:
			   <span style="display: inline-block; background-color: {{ topic.type_color }}; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; color: #fff; padding: 0px 8px 0px 8px; font-size: 11px;">{{ topic.type }}</span> &nbsp;
                          % endif 
		      % endif 
		      By <a href="/member/${topic.author}" class="dark">${topic.author}</a>
		      % if 'source' in topic:
			    via {{ topic.source }}
		      % endif 
		      at ${topic.create_time} , ${topic.view_num|view.filter.float2int} hits
		      % if level == 0:
			&nbsp; <a href="#;" onclick="if (confirm('{{ l10n.sure_to_delete }} #{{ topic.num }} - {{ topic.title|escape }}')) { location = '/delete/topic/{{ topic.num }}'; }" class="op">DELETE</a> <a href="/backstage/tidy/topic/{{ topic.num }}" class="op">TIDY</a>
		      % endif 
		      % if can_move:
			 <a href="/backstage/move/topic/{{ topic.key }}" class="op">MOVE</a>
		      % endif 
		      % if can_edit: 
			 <a href="/edit/topic/{{ topic.num }}" class="op">EDIT</a>
		      % endif 
		      </small>

                </div>
		<%include file="video.html"/>

		% if "content" in topic:
                <div class="inner">
                    <div class="content topic_content">${topic["content"]|view.filter.linebreaksbr,view.filter.htmlspace}</div>
                </div>
		% endif 
            </div>
            % if topic.reply_num == 0: 
            <div class="sep20"></div>
            <div class="glass" align="center"><div class="inner"><span class="white">{{ l10n.no_reply }}</span></div></div>
            % else:
            <div class="sep20"></div>
            <div class="box">
                <div class="cell"><div class="fr">
		{% if reply_reversed %}
			<a href="/t/{{ topic.num }}?r=0">{{ l10n.earlier_replies_first }}</a>
		{% else %}
			<a href="/t/{{ topic.num }}?r=1">{{ l10n.newer_replies_first }}</a>
		{% endif %} &nbsp;<span class="snow">|</span>&nbsp; {% if filter_mode %}<a href="/t/{{ topic.num }}?f=0">{{ l10n.show_all }}</a>{% else %}<a href="/t/{{ topic.num }}?f=1">{{ l10n.just_topic_creator }}</a>{% endif %}</div><span class="fade">${topic.reply_num} ${template.reply} &nbsp;<span class="snow">|</span>&nbsp; ${template.till} ${topic.last_reply_time}</span></div>
                <script type="text/javascript">
                    is_admin = {{ is_admin }};
                    {% if member %}
                    member_id = {{ member.num }};
                    {% else %}
                    member_id = 0;
                    {% endif %}
                    replies_keys = new Array(); replies_ids = new Array(); replies_parents = new Array();
                </script>
                <div id="replies">
		<%include file="topic_replies.html"/>
                </div>
            </div>
            % endif
            % if member:
            <div class="sep20"></div>
            <script type="text/javascript">
            function v() {
                r = document.getElementById('reply_content');
                if (r.value.length == 0) {
                    e = document.getElementById('e');
                    e.innerHTML = "{{ l10n.reply_content_cannot_be_empty }}";
                    return false;
                }
            }
            
            function c() {
                e = document.getElementById('e');
                if (e.innerHTML.length > 0) {
                    e.innerHTML = '';
                }
            }
            </script>
            <div class="box">
		<form action="/topic/${topic["_id"]}" method="post" onsubmit="return v()">
                <div class="cell">
		% if errors:
                	<strong class="black">{{ reply_content_error_message }}</strong>
                % else:
			<div class="fr fade">⬆ <a href="#_top" class="dark">回到顶部</a></div>
                	<span class="fade">${template.add_a_reply_now}</span>
                % endif
           </div>
                <div class="cell">
                    <textarea class="mll" name="content" id="reply_content"  onkeyup="c();"></textarea>
                    <div class="sep10"></div>
                    <div class="fr fade" id="e"></div>
                    <input type="submit" class="super normal button" value="${template.send}" />
                </div>
		</form>
            </div>
            % endif
        </div>
    <div class="c"></div>
    </div>
    </div>
</body>
</html>
